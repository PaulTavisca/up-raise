<% layout('layout') -%>
<% script('/javascripts/models/reviewDocument.js') -%>
<% script('/javascripts/router/reviewDocumentRoute.js') -%>
<% script('/javascripts/controllers/reviewDocumentController.js') -%>
<% script('/javascripts/controllers/goalsController.js') -%>
<% script('/javascripts/controllers/goalController.js') -%>
<% script('/javascripts/views/goalView.js') -%>
<% script('/javascripts/views/goalsView.js') -%>

<script type="text/x-handlebars" data-template-name="reviewDocument">
	{{outlet headerBar}}
	<div class="container">
			<h2> Goals for <strong><%= employee.firstName %></strong> <small>(
			{{#if getContent}}
				approved
			{{else}}
			pending
			{{/if}}
			)</small></h2>
			<h4> Review Cycle (<%= goals.cycle.startDate %> - <%= goals.cycle.endDate %>)</h4>
			<hr />			
			{{render goals }}
	</div>		
		
</script>
<script type="text/x-handlebars" data-template-name="goals">
			
	<% if (user) { %>
		<table class="table table-striped table-responsive table-bordered table-responsive">
			<tr>
				<th class="text-center"> Index</th>
				<th class="col-sm-2 text-center"> KRA</th>
				<th class="col-sm-2 text-center"> Goal-Type</th>
				<th class="text-center"> Description</th>
				<th class="col-sm-1 text-center"> Weightage</th>
				<th class="col-sm-1 text-center"> Actions</th>
			</tr>			
			{{#each itemController="goal"}}
				{{#view UpRaise.GoalView contentBinding="this"}}
					{{#if isEditing}}
					
				
						<td> {{view.adjustedIndex}}</td>
						<td> {{input type="text" classNames="col-sm-2 form-control" placeholder="Enter KRA" value=kra }} </td>
						<td> {{input type="text" classNames="col-sm-2 form-control" placeholder="Enter goal type" value=type }} </td>
						<td> {{textarea classNames="form-control" placeholder="Enter Details" value=description }} </td>
						<td class="col-sm-1 text-center"> {{input type="text" classNames="form-control" placeholder="Eg: 10 %" value=weight }} </td>
						<td>
							<a {{action "cancelRow"}}>Cancel</a>
							<a {{action "saveRow" target=view}}>Save</a>
						</td>
					
					{{ else }}
					
						<td> {{view.adjustedIndex}} </td>
						<td> {{kra}} </td>
						<td> {{type}} </td>
						<td> {{description}} </td>
							
						<td class="text-center"> {{weight}}% </td>
						<td>
							<a {{action "editRow"}}> Edit </a>									
							<a {{action "showDeleteModal"}}> Delete </a>
						</td>								
					
					{{/if}}
				{{/view}}
			{{/each}}
			{{#bs-modal name="deleteModal" fade=true footerButtonsBinding="deleteModalButtons" title="Warning"}}
					        
		    {{/bs-modal}}
			{{#if showAddRow}}
				<tr>
					<td> {{nextIndex}} </td>
					<td> {{input type="text" classNames="form-control" id="new-kra" placeholder="Enter KRA" value=kra }} </td>
					<td> {{input type="text" classNames="form-control" id="new-type" placeholder="Enter goal type" value=type }} </td>
					<td> {{textarea classNames="form-control" id="new-description" placeholder="Enter Details" value=description }} </td>
					<td class="text-center"> {{input type="text" classNames="form-control" id="new-weight" placeholder="Eg: 10 %" value=weight }} </td>
					<td>
						<a {{action "cancelRow"}}>Cancel</a>
						<a {{action "saveRow"}}>Save</a>
					</td>
				</tr>
			{{/if}}
				<tr>
					<td></td>
					<td></td>
					<td></td>
					<td class="text-right success">Total (Must equal 100)</td>
					<td class="text-center">{{totalWeight}}%</td>
					<td></td>
				</tr>
		</table>
		
		<% if (view == 'self') { %>
			
			<div class="col-md-4 text-left">
				<button class="btn btn-primary btn-md" id="btnSubmitGoals" {{action 'showAddGoalRow'}}>Add Goal</button>
			</div>
			<div class="text-right btn-toolbar col-md-8">
				<button class="btn btn-warning btn-md" id="btnSaveDraft" {{action 'reset'}}>Reset</button>
				<% if (goals.status == 'pending') { %>

				<button class="btn btn-info btn-md" id="btnSaveDraft" {{action 'saveDraft'}}>Save Draft</button>
					{{#if showSubmit}}
						<button class="btn btn-primary btn-md" id="btnSubmitGoals" {{action 'requestApproval'}}>Submit for Approval</button>
					{{/if}}
				<% } %>
			</div>
		<% } %>		
			
	<% } %>
	{{render 'footer'}}
</script>
<script type="text/x-handlebars" data-template-name="delete-modal">
	<p class="text-warning"><strong>Are you sure you want to delete this KRA item?</strong></p>
	<p class="text-info"><em>This action is irreversible.</em></p>
</script>
	

	