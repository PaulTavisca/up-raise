<% layout('layout') -%>
<% script('/javascripts/models/goal.js') -%>
<% script('/javascripts/models/dashboard.js') -%>
<% script('/javascripts/models/note.js') -%>
<% script('/javascripts/models/teamuser.js') -%>
<% script('/javascripts/models/reviewDocument.js') -%>
<% script('/javascripts/router/dashboardRoute.js') -%>
<% script('/javascripts/controllers/dashboardController.js') -%>
<% script('/javascripts/controllers/teamuserController.js') -%>
<% script('/javascripts/controllers/goalController.js') -%>
<% script('/javascripts/controllers/reviewDocumentController.js') -%>
<% script('/javascripts/controllers/notesController.js') -%>
<% script('/javascripts/controllers/noteController.js') -%>
<% script('/javascripts/views/goalView.js') -%>
<% script('/javascripts/views/noteView.js') -%>

<script type="text/x-handlebars" data-template-name="dashboard">
	<div class="container">
		{{outlet headerBar}}
		<div>
			{{#if isreviewdocument}}
				<a href="#" {{action gotoKRA}} ><h2> My Goals </h2></a>
				<hr />
				<div>
					<table class="table table-striped table-responsive table-bordered table-responsive">
						<tr>
							<th class="text-center"> KRA</th>
							<th class="text-center"> Goal-Type</th>
							<th class="text-center"> Description</th>
						</tr>
						{{#each goal in reviewdocument.goals itemController="goal"}}
							{{#view UpRaise.GoalView contentBinding="this"}}
								<td> {{kra}}</td>
								<td> {{type}}</td>
								<td> 
									{{description}}
								</td>
							{{/view}}
						{{/each}}					
					</table>
				</div>
			{{else}}
				<h2> Your goals are not set. Click below to set goals. </h2>
				<button class="btn btn-primary btn-md" id="btnSetGoals" {{action 'createReviewDoc'}}>Set Goals</button>				
			{{/if}}
			<h2> My Notes</h2>
			
			<hr />	
			<div>
				<table class="table table-striped table-bordered table-responsive">
					<tr>
						<th>Index</th>
						<th class="col-sm-3">Added</th>
						<th class="text-center">Description</th>
						<th></th>
					</tr>
					{{#each note in notes itemController="note"}}
						{{#view 'note'}}
							<tr>
								<td> {{view.adjustedIndex}}</td>
								<td> {{addedOn}}</td>
								<td> 
									{{description}}</td>
								<td> <a href="#" {{action 'showDeleteModal'}}>Delete</a>
							</tr>
						{{/view}}
					{{/each}}
					{{#if showAddNote}}
						<tr>
							<td> </td>
							<td> </td>
							<td> {{textarea type="text" classNames="form-control" placeholder="Enter Note" value=description }} </td>
							<td></td>
						</tr>
					{{/if}}
				</table>
					{{#if showAddNote}}
						<button class="btn btn-primary btn-md" id="btnSaveNote" {{action 'saveNote'}}>Save</button>
						<button class="btn btn-normal btn-md" id="btnCancelNote" {{action 'cancelNote'}}>Cancel</button>
					{{else}}
						<button class="btn btn-primary btn-md" id="btnSaveNote" {{action 'showAddNote'}}>Add Note</button>
					{{/if}}
			</div>
				<h2> My Team</h2>
			<hr />
			<div>
				<table class="table table-bordered table-responsive">
					<tr>
						<th class="col-sm-3 text-center">Name</th>
						<th class="col-sm-3 text-center">Due date</th>
						<th class="col-sm-3 text-center">Actions</th>
					</tr>

					{{#each teamuser in teamusers itemController='teamuser'}}
							{{#if teamuser.isAppraisalDue}}			
							<tr class="danger">
								<td>
									<a href="#" {{action kra }}>{{teamuser.name}}</a></td>
								<td> {{ reviewdate }}</td>
								<td> 
									<a href="#" {{action review }}> Review Now</a></td>
							</tr>
						{{else }}
							{{#if teamuser.areGoalsSet}}

								<tr>
									<td>
										<a href="#" {{action kra }}>{{teamuser.name}}</a></td>
									<td> {{ reviewdate }}</td>
									<td> 
										<a href="#" {{action kra }}> View Goals</a></td>
								</tr>
							{{else}}
								<tr>
									<td>
										<a href="#" {{action history }}>{{teamuser.name}}</a></td>
									<td> {{ reviewdate }}</td>
									<td></td>
								</tr>							
							{{/if}}
						{{/if}}
							
					{{/each}}					
				</table>
			</div>
		</div>
	</div>
</script>
<script type="text/x-handlebars" data-template-name="delete-modal">
	<p class="text-warning"><strong>Are you sure you want to delete?</strong></p>
	<p class="text-info"><em>This action is irreversible.</em></p>
</script>
